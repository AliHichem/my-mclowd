{#
    Choose base layout:

        - {% extends 'KnpRadBundle:Layout:h5bp.html.twig' %} - HTML5Boilerplate
        - {% extends 'KnpRadBundle:Layout:tb.html.twig' %} - Twitter Bootstrap

    This template is only a configuration layer.
    Use `src/App/Resources/layout.html.twig` as your
    app-related layout.
#}

<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        {% block headers %}{% endblock headers %}
        {% block stylesheets %}
            <link rel="stylesheet" href="{{ asset('bundles/knprad/bootstrap/css/bootstrap.min.css') }}" />
            <link rel="stylesheet" href="{{ asset('bundles/knprad/bootstrap/css/bootstrap-responsive.min.css') }}" />
            <link rel="stylesheet" href="{{ asset('css/main.css') }}" />
        {% endblock stylesheets %}
            
        {# load socket.io only if user is logged in #}
        {% if app.user %}
            <script src="{{ settings.getNodeAddr }}:{{ settings.getNodePort }}/socket.io/socket.io.js"></script>
        {% endif %}            
    </head>
    <body>
        {% if app.user %}
        <script type="text/javascript">
            var socket = io.connect('{{ settings.getNodeAddr }}:{{ settings.getNodePort }}');

            // on connection to server, ask for user's name with an anonymous callback
            socket.on('connect', function(){
                // call the server-side function 'adduser' and send one parameter (value of prompt)
                socket.emit('adduser', '{{ app.user.username }}', {{ app.user.id }},'{{ app.user.id|md5 }}', null, null);
            });
            
            socket.on('updatenotifications', function (n0, n1) {
                $(n0).html(n1); 
            });
        </script>
        {% endif %}

        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

         <div class="container">

            <h2>Mclowd Markretplace</h2>

            <ul class="nav nav-pills">
                {% if is_granted("IS_AUTHENTICATED_FULLY") %}     
                    <li><a href="{{ path('fos_user_security_logout') }}">Logout</a></li>            
                {% else %}
                    <li><a href="{{ path('fos_user_security_login') }}">Login</a></li>            
                    <li><a href="{{ path('client_registration') }}">Register as client</a></li>                                
                    <li><a href="{{ path('contractor_registration') }}">Register as contractor</a></li>
                {% endif %}
                <li><a href="{{ path('app_tasks_new') }}">Add new task</a></li>            
                <li><a href="{{ path('app_tasks_index') }}">Browse task</a></li>
            </ul>
            {% if  app.session.flashbag.count() > 0 %}
                <section id="flash-messages">
                {% for type, flashMessages in app.session.flashbag.all() %}
                    {% for flashMessage in flashMessages %}
                        <div class="flash-{{ type }}">
                            {{ flashMessage }}
                        </div>
                    {% endfor %}
                {% endfor %}
                </section>
            {% endif %}

        
            {% block content %}{% endblock content %}
        </div>
        {% block javascripts %}
            <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        {% endblock javascripts %}
    </body>
</html>
