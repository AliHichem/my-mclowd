{% extends '::base.html.twig' %}

{% block content %}
    <div class="row">
        <form  class="shared-form" class="form-wrap" action="{{ path('contractor_registration') }}" {{ form_enctype(form) }} method="POST" class="fos_user_registration_register" novalidate data-validate="parsley">
            <fieldset>
                <legend>Create a contractor account</legend>
                <div class="span12">
                    <a href="{{ path('client_registration') }}">Not a contractor? Create a client account here.</a>
                </div>
                <div class="span6">
                    {{ form_errors(form) }}
                    {{ form_widget(form) }}
                    <div span="6">
                        <input class="submit"  type="submit" value="{{ 'registration.submit'|trans({}, 'FOSUserBundle') }}" />
                    </div>
                    {{ form_rest(form) }}
                </div>
                <div class="span6">
                    <div class="row-fluid">
                        <div class="span12">
                            <div class="span12">Already have an account?</div>
                            <div class="span12">
                                <a href="{{ path('fos_user_security_login') }}">Sign in here</a>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span12">
                            <div class="span12">Not a contractor?</div>
                            <div class="span12">
                                <a href="{{ path('client_registration') }}">Create a regular account here</a>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $(function () {
            {% if app.request.isMethod('post') %}
            {#
                if a normal post request is validated and a user is created,
                this will not be rendered since the user would be redirected
                to the welcome page
            #}
            $('form .help-inline').remove();
            $('form .error').removeClass('error');
            $('form').parsley('validate');
            {% endif %}
            // this will fix the blocking requests while also forcing 1 request at a time
            var activeRequests = {};
            $.ajaxSetup({
                beforeSend: function(jqXHR, options) {
                    var url = options.url;
                    if (url.match(/\/register\/validate\/\w+\?fos_user_registration_form/gi) !== null) {
                        url = url.split('=', 2)[0];
                        if (url in activeRequests) {
                            activeRequests[url].abort();
                            delete activeRequests[url];
                        }
                        activeRequests[url] = jqXHR;
                        options.async = true;
                    }
                }
            });
        });
    </script>
{% endblock %}